version: 2.0

jobs:
  build-deb:
    docker:
      - image: frrouting/frr:topotests-latest
    steps:
      - checkout
      - run:
          name: Compile FRR
          command: |
            ./bootstrap.sh
            ./configure \
                --enable-static-bin \
                --enable-static \
                --enable-shared \
                --with-moduledir=/usr/lib/frr/modules \
                --prefix=/usr \
                --localstatedir=/var/run/frr \
                --sbindir=/usr/lib/frr \
                --sysconfdir=/etc/frr \
                --enable-multipath=0 \
                --enable-fpm \
                --enable-sharpd \
                $EXTRA_CONFIGURE \
                --with-pkg-extra-version=-topotests
            cpu_count=$(cat /proc/cpuinfo | grep -w processor | wc -l)
            if [ $? -ne 0 ]; then
                    cpu_count=2
            fi
            make -j${cpu_count}

workflows:
  version: 2
  build:
    jobs:
      - build-deb
